import cv2
import numpy as np
from mss import mss
from ultralytics import YOLO
import time

# ----------------------------------------
# CONFIGURACIÓN
# ----------------------------------------

# Cargar YOLO (usa el modelo que tengas)
model = YOLO("yolov8n.pt")     # o tu .pt personalizado

# Área de captura (segundo monitor)
monitor_config = {
    "top": 0,        # píxel superior de la pantalla
    "left": 0,       # píxel izquierdo
    "width": 1280,   # cambia al tamaño real de tu monitor
    "height": 720
}

sct = mss()

# ----------------------------------------
# LOOP PRINCIPAL
# ----------------------------------------
print("Iniciando captura de pantalla con YOLO... Presiona Q para salir.")

while True:
    frame = np.array(sct.grab(monitor_config))
    frame = cv2.cvtColor(frame, cv2.COLOR_BGRA2BGR)

    # Pasar frame por YOLO
    results = model(frame)

    # Dibujar detecciones
    annotated = results[0].plot()

    # Mostrar
    cv2.imshow("YOLO SCREEN TEST", annotated)

    # Salir con Q
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

cv2.destroyAllWindows()
